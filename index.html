<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <style>
    .top-nav {
      height: 70px;
    }

    .full-height {
      height: -webkit-fill-available;
    }

    .home {
      text-align: center;
    }

    .download-link {
      color: blue;
      text-decoration-line: underline !important;
    }

    .vc-container {
      margin-top: auto;
    }

    .wrap {
      display: flex;
      justify-content: center;
    }

    .inner {
      align-self: center;
      padding-bottom: 20em;
    }

    /* .scrollable {
      overflow-y: auto;
    } */

    #sidebar::-webkit-scrollbar {
      width: 0px;
      background: transparent;
      /* make scrollbar transparent */
    }

    td {
      padding-right: 15px !important;
    }

    .comment-link {
      color: blue;
      text-decoration-line: underline !important;
    }

    a.active {
      background-color: #6c757d;
    }

    a.comment-link {
      word-wrap: break-word;
    }

    p {
      word-wrap: break-word;
      text-indent: 30px;
    }

    img.center {
      display: block;
      margin: 0 auto;
    }

    img.fill {
      width: -webkit-fill-available;
    }

    .inner > p {
      text-indent: 0px;
    }
  </style>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="style2.css">
  <script src="withinviewport.js"></script>
  <script src="jquery_withinViewport.js"></script>
  <title>微處理機實驗工作日誌</title>

  <script>
    /**
     * Within Viewport jQuery Plugin
     *
     * @description Companion plugin for withinviewport.js - determines whether an element is completely within the browser viewport
     * @author      Craig Patik, http://patik.com/
     * @version     2.0.0
     * @date        2016-12-19
     */
    (function ($) {
      /**
       * $.withinviewport()
       * @description          jQuery method
       * @param  {Object}      [settings] optional settings
       * @return {Collection}  Contains all elements that were within the viewport
       */
      $.fn.withinviewport = function (settings) {
        var opts;
        var elems;

        if (typeof settings === 'string') {
          settings = {
            sides: settings
          };
        }

        opts = $.extend({}, settings, {
          sides: 'all'
        });
        elems = [];

        this.each(function () {
          if (withinviewport(this, opts)) {
            elems.push(this);
          }
        });

        return $(elems);
      };

      // Main custom selector
      $.extend($.expr[':'], {
        'within-viewport': function (element) {
          return withinviewport(element, 'all');
        }
      });

      /**
       * Optional enhancements and shortcuts
       *
       * @description Uncomment or comment these pieces as they apply to your project and coding preferences
       */

      // Shorthand jQuery methods

      $.fn.withinviewporttop = function (settings) {
        var opts;
        var elems;

        if (typeof settings === 'string') {
          settings = {
            sides: settings
          };
        }

        opts = $.extend({}, settings, {
          sides: 'top'
        });
        elems = [];

        this.each(function () {
          if (withinviewport(this, opts)) {
            elems.push(this);
          }
        });

        return $(elems);
      };

      $.fn.withinviewportright = function (settings) {
        var opts;
        var elems;

        if (typeof settings === 'string') {
          settings = {
            sides: settings
          };
        }

        opts = $.extend({}, settings, {
          sides: 'right'
        });
        elems = [];

        this.each(function () {
          if (withinviewport(this, opts)) {
            elems.push(this);
          }
        });

        return $(elems);
      };

      $.fn.withinviewportbottom = function (settings) {
        var opts;
        var elems;

        if (typeof settings === 'string') {
          settings = {
            sides: settings
          };
        }

        opts = $.extend({}, settings, {
          sides: 'bottom'
        });
        elems = [];

        this.each(function () {
          if (withinviewport(this, opts)) {
            elems.push(this);
          }
        });

        return $(elems);
      };

      $.fn.withinviewportleft = function (settings) {
        var opts;
        var elems;

        if (typeof settings === 'string') {
          settings = {
            sides: settings
          };
        }

        opts = $.extend({}, settings, {
          sides: 'left'
        });
        elems = [];

        this.each(function () {
          if (withinviewport(this, opts)) {
            elems.push(this);
          }
        });

        return $(elems);
      };

      // Custom jQuery selectors
      $.extend($.expr[':'], {
        'within-viewport-top': function (element) {
          return withinviewport(element, 'top');
        },
        'within-viewport-right': function (element) {
          return withinviewport(element, 'right');
        },
        'within-viewport-bottom': function (element) {
          return withinviewport(element, 'bottom');
        },
        'within-viewport-left': function (element) {
          return withinviewport(element, 'left');
        }
        // Example custom selector:
        //,
        // 'within-viewport-top-left-45': function (element) {
        //     return withinviewport(element, {sides:'top left', top: 45, left: 45});
        // }
      });
    }(jQuery));

    $(document).on('click', 'a[href^="#"]', function (event) {
      event.preventDefault();

      $('html, body').animate({
        scrollTop: $($.attr(this, 'href')).offset().top - 80
      }, 500);
    });
    $(window).bind("scroll", function () {

      $("#content > h2").withinviewport().each(function () {
        $("#scrollspytarget > li > a").removeClass("active");
        $('#scrollspytarget > li > a[href="#' + $(this)[0].id + '"]').addClass('active');
      });
    });
  </script>



</head>

<body>
  <div class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top top-nav">
    <span class="navbar-brand mb-0 h1">微處理機實驗工作日誌</span>
  </div>

  <div class="wrapper">
    <!-- Sidebar Holder -->
    <nav id="sidebar" class="scrollable">
      <ul class="list-unstyled components" id="scrollspytarget">
        <li>
          <a class="active" href="#home">首頁</a>
        </li>
        <li>
          <a href="#section1">2018年3月14日</a>
        </li>
        <li>
          <a href="#section2">2018年3月21日</a>
        </li>
        <li>
          <a href="#section3">2018年3月28日</a>
        </li>
        <li>
          <a href="#section4">2018年4月4日</a>
        </li>
        <li>
          <a href="#section5">2018年4月11日</a>
        </li>
        <li>
          <a href="#section6">2018年4月18日</a>
        </li>
        <li>
          <a href="#section7">2018年4月25日</a>
        </li>
        <li>
          <a href="#section8">2018年5月2日</a>
        </li>
        <li>
          <a href="#section9">2018年5月9日</a>
        </li>
        <li>
          <a href="#section10">2018年5月16日</a>
        </li>
        <li>
          <a href="#section11">2018年5月23日</a>
        </li>
        <li>
          <a href="#section12">2018年5月30日</a>
        </li>
        <li>
          <a href="#section13">2018年6月6日</a>
        </li>
        <li>
          <a href="#section14">總結</a>
        </li>
        

      </ul>
    </nav>

    <!-- Page Content Holder -->
    <div id="content">
      <h2 id="home"></h2>
      <div class="full-height home wrap">
        <div class="inner">
          <h1>微處理機實驗工作日誌</h1>
          <h5>404415041 莊雅博</h5>
          <h5>404415037 楊子緯</h5>
          <p>PDF版下載：
            <a href="#" class="download-link">載點</a>
          </p>
        </div>
      </div>



      <div class="line"></div>
      <h2 id="section1">2018年3月14日 星期三</h2>
      <h3>Arduino藍芽連線：</h3>
      <p>因為HC-06藍芽模組會佔用Arduino的Tx/Rx接腳，所以要先把將程式寫進Arduino才可以接上藍芽模組。以下是我們測試用的程式碼：</p>
      <div id="bluetooth">
        <script>
          $(function () {
            $("#bluetooth").load("src/bluetooth.html");
          });
        </script>
      </div>

      <p>首先在Setup裡面先設定好包率以及輸出腳位，Pin13是Arduino板子上的LED，接著在Loop內不斷讀取接收到的訊息(第10行的Serial.read())，如果接收到”n”則亮LED，如果接收到”f”則關掉LED。另外在電腦上先和HC-06建立連線，其中連線的預設密碼為1234，連線後在終端機輸入：ls
        /dev/tty.*，這串指令會列出所有藍芽連線的名稱，HC-06的名稱應為「tty.HC-06-DevB」，接著輸入：sudo cu -s 9600 -l /dev/tty.HC-06-DevB，輸入後因為sudo的關係，系統會需要你輸入電腦密碼，輸入密碼後即可透過終端機傳送訊息到Arduino。</p>
      <span>參考資料：
        <br>
      </span>
      <span class="comment">vince 學習筆記: Arduino HC-06 藍牙模組 使用MAC控制</span>
      <a class="comment-link" href="http://vincecc.blogspot.tw/2014/01/arduino-hc-06-mac.html">http://vincecc.blogspot.tw/2014/01/arduino-hc-06-mac.html</a>
      <div class="line"></div>

      <h2 id="section2">2018年3月21日 星期三</h2>
      <h3>Android 重力感應器使用方式：</h3>
      <p>由於我們著組會用到手機傾斜的方式來控制遙控車，所以會需要用到手機內的感應器來偵測傾角。我們可以利用Android提供加速度感應器(Accelerometer)或重力感應器(Gravity Sensor)來判斷手機的傾角，兩個感應器都會提供裝置的加速度資訊，但兩者最大的不同是加速度感應器會偵測裝置受到的所有加速度，像是裝置在移動時的加速度、重力加速度等等，而重力感應器則會整合加速度感應器和陀螺儀(Gyroscope)的資訊過濾掉裝置在移動時產生的加速度而留下單純得重力加速度，但這個感應器數值只是用在有陀螺儀的裝置上。以下是讀取感應器數值的程式碼：</p>
      <div id="androidSensor">
        <script>
          $(function () {
            $("#androidSensor").load("src/androidSensor.html");
          });
        </script>
      </div>
      <br>
      <p>為了得到感應器的數值必須在第3行透過getSystemService取得SensorManager，接著用sensorManager.getDefaultSensor(Sensor.TYPE_GRAVITY)來取得重力感應器，這邊的Sensor.TYPE_GRAVITY可以改成其他參數來取得不同的感應器，像是傳入Sensor.TYPE_GYROSCOPE可以得到陀螺儀。</p>
      <img src="/img/axis_device.png" alt="" srcset="" class="center">
      <p>得到感應器之後，必須註冊一個傾聽者(Listener)才能夠得到感應器的數值。在第4行建立一個SensorEventListener物件，在第6行，當感應器數值有變化時會呼叫這個方法(Method)，這邊的程式是當感應器的數值有變化時，會把感應器的數值寫到主控台(Console)，其中sensorEvent.values[0]、sensorEvent.values[1]、sensorEvent.values[2]分別代表X、Y、Z方向的加速度(如上圖所示)。最後在第21行把前面的重力感應器註冊到傾聽者。</p>
      <span>參考資料：</span>
      <br>
      <span class="comment">Motion Sensors | Android Developers</span>
      <br>
      <a class="comment-link" href="https://developer.android.com/guide/topics/sensors/sensors_motion.html">https://developer.android.com/guide/topics/sensors/sensors_motion.html</a>
      <br>
      <span class="comment">android - Accelerometer vs Gravity sensor - Stack Overflow</span>
      <br>
      <a class="comment-link" href="https://stackoverflow.com/questions/22102405/accelerometer-vs-gravity-sensor">https://stackoverflow.com/questions/22102405/accelerometer-vs-gravity-sensor</a>
      <div class="line"></div>

      <h2 id="section3">2018年3月28日 星期三</h2>
      <h3>Android 藍芽使用方式：</h3>
      <p>這部分的程式碼是從GitHub上複製下來並修改而來的，我也花了不少時間理解他，因此我會把整個連線的過程分成三個部分來說明。</p>
      <h4>第一部分-藍芽連線基礎：</h4>
      <p>要跟HC-06連線我們需要兩參數，位址和UUID。位址是HC-06的硬體位址(Hardware Address)，可以從包裝上或是直接用電腦和HC-06連線後取得。UUID代表通用唯一識別碼(Universally Unique
        Identifier)，UUID在這邊是用來標示藍芽設備所提供的服務，有點像是網路架構內應用層的port number，20代表FTP、80代表HTTP等等，一個藍牙設備可以提供多種服務，像是A2DP(藍牙音訊傳輸)、HSB(耳機)、PBAP(電話簿)、SPP(串列埠通訊)等等，這些常用的服務都有一組對應的UUID，若是想要定義一個新的服務可以自己隨機產生一組UUID，只要收送兩端有一樣的UUID即可通訊。這邊我們想要跟HC-06連線，而HC-06用的是SPP(Serial
        Port Protocol)，在網路上可以查到他的UUID為00001101-0000-1000-8000-00805F9B34FB。</p>
      <div id="androidBluetooth_01">
        <script>
          $(function () {
            $("#androidBluetooth_01").load("src/androidBluetooth_01.html");
          });
        </script>
      </div>
      <br>
      <h4>第二部分-Android開啟藍芽：</h4>
      <p>這部分主要是在講解怎麼開啟Android裝置的藍芽，要在Android APP上使用藍芽之前，必須取得使用藍芽的權限。要取得藍芽的使用權限則必須在AndroidManifest.xml內加入以下程式碼：</p>
      <div id="androidPermission">
        <script>
          $(function () {
            $("#androidPermission").load("src/androidPermission.html");
          });
        </script>
      </div>
      <br>
      <p>接著啟動藍芽的程式碼如下：</p>
      <div id="androidBluetooth_02">
        <script>
          $(function () {
            $("#androidBluetooth_02").load("src/androidBluetooth_02.html");
          });
        </script>
      </div>
      <br>
      <p>開啟藍芽連線的第一步是要先確認這個裝置是否支援藍芽，在第17行先取得BluetoothAdapter，接著第18行檢查藍芽狀態，在checkBTState內先檢查剛剛取得的BluetoothAdapter是否為null，若為null代表此裝置部支援藍芽，接著由第71行檢查藍芽是否開啟，若藍芽已開啟就直接去取得連線的程式碼，若藍芽處於關閉的狀態，則要求使用者開啟藍芽。</p>
      <p>為了在不離開APP的情況下要求使用者開啟藍芽，我們可以啟動一個新的Activity來要求使用者開啟藍芽，Activity代表應用程式中的單一畫面。在第76行BluetoothAdapter.ACTION_REQUEST_ENABLE是android.Bluetooth函式庫內的一個Activity，在76行把它包裝到意圖(Intent)後下一行利用startActivityForResult啟動這個Activity。這邊的startActivityForResult直翻成中文還滿白話的，就是為了某種結果去啟動一個Activity，startActivityForResult的第二個參數是我在第10行定義的，這個數字是當我們使用多個startActivityForResult時用來辨別Activity傳回來的結果。當我們剛剛啟動的Activity結束後會呼叫onActivityResult(22行)並傳入剛剛提到的requestCode和執行結果resultCode。進入onActivityResult後先用requstCode判斷是不是我們之前啟動的Activtiy，接著用resultCode判斷執行結果，RESULT_OK代表使用者開啟藍芽並執行取得連線的程式碼(getConnection())。</p>
      <h4>第三部分-Android傳輸資料與多線程：</h4>
      <p>這部分主要是在講解Android怎麼和其他裝置連線。在和其他裝置傳輸資料時會需要等待對方ACK之類的回應，為了避免等待的過程阻礙UI Thread(UI Thread Blocking)造成使用上的頓挫感，因此這部分的程式會用到多線程(multithread)的概念。和其他裝置連線的程式其實就幾行而已，只是被很多try、catch包起來(從第31行到63行)，加上程式碼跟Google開發者指南網站上講得基本上是一樣的，因此這部分主要以介紹多線程的概念為主。</p>
      <p>為了創造新的執行線程，我們得創造一個繼承Thread的類別(class)。以下是我們要創造的類別：</p>
      <div id="androidBluetoothConnectedThread_01">
        <script>
          $(function () {
            $("#androidBluetoothConnectedThread_01").load("src/androidBluetoothConnectedThread_01.html");
          });
        </script>
      </div>
      <br>
      <p>這邊我宣告一個新的類別ConnectedThread並繼承Thread類別，同時為了接收、傳送資料，在建構子這邊我把藍芽接口(socket)傳進來，並取得輸入、輸出串流。接著我們要覆寫父類別內的run方法(method)。</p>
      <div id="androidBluetoothConnectedThread_02">
        <script>
          $(function () {
            $("#androidBluetoothConnectedThread_02").load("src/androidBluetoothConnectedThread_02.html");
          });
        </script>
      </div>
      <br>
      <p>這邊的程式是當這個執行緒建立時會執行的程式碼，這邊的程式基本上就是不斷的讀取輸入串流，一旦讀取到資料就送到UI Thread中，至於是怎麼傳送到UI Thread的會在後面說明。完成了讀取的部分之後我們現在要來寫傳送的部分。</p>
      <div id="androidBluetoothConnectedThread_03">
        <script>
          $(function () {
            $("#androidBluetoothConnectedThread_03").load("src/androidBluetoothConnectedThread_03.html");
          });
        </script>
      </div>
      <br>
      <p>這邊加入了write方法，看起來有點複雜，但真正在傳送資料的只有第42行的mmOutStream.write(bytes);，其他的程式碼都是在回傳成功或失敗的執行結果。接下來要說明如何傳送資訊回到UI Thread。</p>

      <span>參考資料：</span>
      <br>
      <span class="comment">Motion Sensors | Android Developers</span>
      <br>
      <a class="comment-link" href="https://developer.android.com/guide/topics/sensors/sensors_motion.html">https://developer.android.com/guide/topics/sensors/sensors_motion.html</a>
      <br>
      <span class="comment">android - Accelerometer vs Gravity sensor - Stack Overflow</span>
      <br>
      <a class="comment-link" href="https://stackoverflow.com/questions/22102405/accelerometer-vs-gravity-sensor">https://stackoverflow.com/questions/22102405/accelerometer-vs-gravity-sensor</a>
      <div class="line"></div>
      <h2 id="section4">2018年4月4日 星期三</h2>
      <h3>春假：</h3>
      <p>由於嘉義的電子材料行售價高昂，於是我們利用春假回台中時，順便到台中火車站附近的電子材料行購買我們所需的零件。當天我們買的東西並不多，一顆伺服馬達跟一包齒輪組而已。</p>
      <div class="line"></div>
      <h2 id="section5">2018年4月11日 星期三</h2>
      <h3>伺服馬達的使用方式：</h3>
      <p>剛開始我們使用Arduino的範例程式碼試著了解伺服馬達的使用方式時，我們遇到了極大的問題，當我們照著網路上的範例打時(程式碼如下)，我們預期馬達會轉到90度的位置，但我們的伺服馬達並沒有轉到指定的角度反而是不停地選轉，為了找出倒底是哪裡出錯了，我們開始研究伺服馬達的運作原理。</p>
      <div id="servo">
        <script>
          $(function () {
            $("#servo").load("src/servo.html");
          });
        </script>
      </div>
      <img src="/img/signal.png" alt="" srcset="" class="center fill">
      <p>經過一番Google之後，我們學習到伺服馬達是利用20ms為週期的PWM訊號來控制角度，當脈衝寬度為1ms時，馬達轉到0度的位置；當脈衝寬度為1.5ms時，馬達轉到90度的位置；當脈衝寬度為2ms時，馬達轉到180度的位置。得知這項資訊後，我們用示波器檢視Arduino的輸出是否正確。</p>
      <img src="/img/servo.JPG" alt="" srcset="" class="center fill">
      <p>在示波器檢視下，Arduino輸出如上圖，照片中並未拍到脈衝寬度，但我們確認示波器中顯示的脈衝寬度為1.5ms。現在我們確認了Arduino的輸出是沒有問題的，因此我們開始把焦點放在伺服馬達上。之後我們跟實驗室的學長借了一顆伺服馬達，並連接上Arduino後，學長的馬達正確的轉到90的位置。雖然這顆故障的伺服馬達讓我們這週沒什麼進度，但我們卻因此學習到了伺服馬達的運作原理也算是因禍得福吧。</p>
      <div class="line"></div>
      <h2 id="section6">2018年4月18日 星期三</h2>
      <h3>拆車＆L298N：</h3>
      <p>為了讓前輪部份能使用伺服馬達控制，必須先破壞部分結構，我們使用美工刀刻出伺服馬達所需的空間，過程中我們花了不少時間，最後將伺服馬達裝上並以熱熔膠固定。利用春假買的齒輪組，我們將伺服馬達的輸出連接到車子前輪的方向控制。</p>
      <p>在拆解模型車的同時，我們用實驗室的焊槍把兩條電線焊在電池盒的正負極，接著將另外兩條電線焊在馬達的正負極，最後將這四條線鎖在L298N上，結果如下圖所示。</p>
      <img src="/img/car.JPG" alt="" srcset="" class="center fill">
      <p>因為我們在安裝伺服馬達的過程中花了不少時間，因此我們這週的進度只有安裝伺服馬達和安裝L298N直流馬達控制器。</p>
      <div class="line"></div>
      <h2 id="section7">2018年4月25日 星期三</h2>
      <h3>L298N驅動DC馬達失敗：</h3>
      <p>上週我們把L298N裝上，我分打算用L298N上的穩壓器輸出5伏特的電給Arduino使用，這過程還滿順利的，單純的把L298N的5V輸出和地線分別接上Arduino就可以了。接著我們用以下的程式碼試著讓馬達以50%的速度順時針旋轉，但馬達僅持續發出嗶聲而不轉動。</p>
      <div id="dc_mortor">
        <script>
          $(function () {
            $("#dc_mortor").load("src/dc_mortor.html");
          });
        </script>
      </div>
      <p>接這我們一如往常地把Arduino接上示波器觀察輸出訊號，輸出訊號如下圖所示，在我們眼中是個完美的50% duty cycle的PWM訊號。於是我們開始懷疑是不是哪裡短路了，或是L298N的接法錯誤。</p>
      <img src="/img/pwm.JPG" alt="" class="center fill">
      <p>經過一段時間的搜尋後，我們發現L298N的接法沒錯，IN3、IN4控制馬達的方向和停止，enB的跳線接著啟動B端輸出，但我們就是無法輸出讓馬達轉動。</p>
      <div class="line"></div>
      <h2 id="section8">2018年5月2日 星期三</h2>
      <h3>換電池：</h3>
      <p>這星期我們以為有可能是因為杜邦線鬆脫倒置直流馬達部會轉動，所以我們把所有和L298N連接的杜邦線全部拔掉重接，但這麼做並沒有解決馬達不會轉的問題，接著我們把注意放到電池上，猜測可能是電池沒電了，當我們換了新的電池後，L298N和直流馬達奇蹟似的復活了。但好景不常，接下來我們在做總體的測試時，我們發現伺服馬達又故障不轉了。</p>
      <p>經過一番檢查後，我們發現當Arduino上只有伺服馬達，沒有L298N時，伺服馬達正常的運作，但只要一接上L298N伺服馬達就不會轉動了。因為剛剛換了電池，我們立刻把注意力放在電力供應方面的問題，因此我們開始猜測原因可能是電力不足導致，所以將Arduino改成用行動電源驅動，而不是用L298N的5V輸出驅動Arduino。當我們接上行動電源後，直流馬達和伺服馬達便開始正常運作。</p>
      <div class="line"></div>
      <h2 id="section9">2018年5月9日 星期三</h2>
      <h3>藍芽接收：</h3>
      <p>手機端的藍芽很久以前就寫好了，現在我們要開始寫Arduino接收手機藍芽傳輸的訊息。傳輸時是由手機傳送一組由前進後退、PWM、轉向角度等等的資訊組成的一組數字字串</p>
      <p>一開始我們天真的以為可以直接讀入字串類似這樣：str = Serial.read()，但這樣完全不可行，因為Serial.read()一次只會讀取一個字元，不是讀取一串字串。得知這件事後，我們開始用迴圈一個一個字元的讀取訊息。因為我們要一個字元一個字元的讀取訊息，為了確保訊息的完整性和正確性，我們必須確保每條訊息的長度一致，因此，當PWM或是角度訊息不足三位數時，在Android端必須先補零再傳送。以下是我們實際實作的內容，當Arduino讀取到8個字的時候，代表訊息接收完成並輸出到序列。</p>
      <div id="bluetooth_read">
        <script>
          $(function () {
            $("#bluetooth_read").load("src/bluetooth_read.html");
          });
        </script>
      </div>
      <div class="line"></div>
      <h2 id="section10">2018年5月16日 星期三</h2>
      <h3>藍牙測試：</h3>
      <p>上星期我們用迴圈讀取解決我們讀取藍芽資訊的問題，接著我們為了避免傳輸過程中發生錯誤導致後續的資料全部出錯，因此我們在字串最前面加上一個S代表訊息的開頭，如下方程式碼所示：</p>
      <div id="bluetooth_read_improved">
        <script>
          $(function () {
            $("#bluetooth_read_improved").load("src/bluetooth_read_improved.html");
          });
        </script>
      </div>
      <p>成功的在Arduino接收Android手機傳送的藍芽訊息後，我們開始把接收到的字串一一的解碼並輸出到Servo、L298N等等。在把字串轉為輸字的過程中，我們原本想說既然是C語言打出來的，那引用一下String.h應該可以解決我們一竊的問題吧，但事實總是殘酷的，加了#include <String.h>就編譯不過，於是我們回到最原始的ASCII直接轉換，成功的把數字解碼出來。</p>
      <div id="bluetooth_string">
        <script>
          $(function () {
            $("#bluetooth_string").load("src/bluetooth_string.html");
          });
        </script>
      </div>
      <div class="line"></div>
      <h2 id="section11">2018年5月23日 星期三</h2>
      <h3>超聲波安裝：</h3>
      <p>在安裝車前超聲波感應器的時候，因為在delay的時候時間設定過短，導致超聲波感應器無法正常啟用，原因是因為pulseIn讀取需要時間，後將時間延遲 5毫秒之後，即可正常運作。而後，在將車後的超聲波感應器也裝上後，發現兩個都無法使用，原因是因為我將兩個超聲波同時delay，結果就是第一個能使用，而第二個只會讀到0。後將兩者分開延遲即解決問題。</p>
      <p>另外，原先當超音波感測到障礙物在安全距離內，車子就會無法前進與後退，後改成前方有障礙物時不能前進只能後退，反之亦然。</p>
      <div class="line"></div>
      <h2 id="section12">2018年5月30日 星期三</h2>
      <h3>統整測試：</h3>
      <p>這周我注意到在Arduino上讀取藍芽的方法是經由序列輸入，同時我想起上個學期微處理機課程中提到的Serial Interrupt，因此我開始上網搜尋Arduino上有沒有類似的功能，經過搜尋後，我發現Arduino上有一個serialEvent的方法可以用，所以我就把原本在loop內讀取的方式改到serialEvent內。以下是我們的實作程式：</p>
      <div id="bluetooth_read_serialEvent">
        <script>
          $(function () {
            $("#bluetooth_read_serialEvent").load("src/bluetooth_read_serialEvent.html");
          });
        </script>
      </div>
      <div class="line"></div>
      <h2 id="section13">2018年6月6日 星期三</h2>
      <h3>74138</h3>
      <p>這週我們打算為遙控車加上頭燈、方向燈、煞車燈等等，但由於先前用了太多元件，導致Arduino上的pin腳不足，於是我們和老師借了74138解碼ic來點亮我們的LED。拿到了74138後我們發現一個重大的困難處，74138一次只能輸出一顆LED，因此我們想到用快速開關LED的方式，讓多顆LED燈看起來像是同時點亮的。剛開始我們把切換LED的程式直接放在Loop()內，程式碼如下：</p>
      <div id="switch_loop">
        <script>
          $(function () {
            $("#switch_loop").load("src/switch_loop.html");
          });
        </script>
      </div>
      <p>這段程式碼在這邊運作正常，三顆LED同時啟動，但到了我們完整的程式碼時，LED卻是分別閃爍。經過我們著解掉一段一段程式碼的後，我們發現是超音波的延遲讓LED無法看起來像是同時在亮。前述的方式失敗了，但其實我一開始就有想到另一個方式，只是直接放進loop內比較簡單無腦。另一個方式是利用上個學期微處理機課程中學到的Timer Interrupt來實作，因為我們的Timer1已經被Servo.h這個函示庫用掉了，所以我們選擇用Timer2作為我們的觸發計時器。在尋找如何啟用Timer Interrupt的過程中，我注意到Arduino上的PWM輸出其實是依賴Timer來實作的，其中腳位5和6使用timer0；腳位9和10使用timer1；腳位11和3使用timer2。因此我們把原本在腳位11控制轉速的PWM輸出換到腳位6去。</p>
      <div class="line"></div>
      <h2 id="section14">總結</h2>
      <h3>整體程式碼</h3>
      <div id="main">
        <script>
          $(function () {
            $("#main").load("src/main.html");
          });
        </script>
      </div>
      <div class="line"></div>
    </div>
  </div>

</body>

</html>